<!DOCTYPE html><html><head><title>ETA Notifications</title><style>body, html {
  height:100%;
  width:100%;
  padding:0;
  margin:0;
  overflow:hidden;
  background-color:#ddd;
}
.wrapper {
  height:100%;
  width:100%;
}</style><link rel="shortcut icon" href="//twilio.com/bundles/marketing/img/favicons/favicon.ico"><link rel="apple-touch-icon" href="//twilio.com/bundles/marketing/img/favicons/favicon_57.png"><link rel="apple-touch-icon" sizes="72x72" href="//twilio.com/bundles/marketing/img/favicons/favicon_72.png"><link rel="apple-touch-icon" sizes="114x114" href="//twilio.com/bundles/marketing/img/favicons/favicon_114.png"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"><link rel="stylesheet" href="viewsaurus.css"></head><body><div class="wrapper"><div id="viewsaurus" data-title="ETA Notifications"><div class="saurus-panes"><div class="saurus-prose"><div class="saurus-prose-header"><div class="title-outer"><span class="step-title">ETA Notifications</span></div></div><div class="saurus-nav-buttons"><div class="saurus-nav-button nav-overview"><div class="saurus-nav-button-inner"><i class="fa fa-fw fa-list"></i></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-previous"><div class="saurus-nav-button-inner"><a href=""> <i class="fa fa-fw fa-play fa-rotate-180"></i></a></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-next clickable"><div class="saurus-nav-button-inner"><a href="#1"> <i class="fa fa-fw fa-play"></i></a></div></div><div class="saurus-next-title"><span class="next-title-inner"></span></div></div><div class="saurus-progress-bar"></div><div class="saurus-start"><p>In this tutorial, we will learn how to implement ETA Notifications using Python - Flask and Twilio</p><a href="#0">Start Tutorial</a></div><div class="saurus-content"><div data-title="ETA Notifications Flask" class="chapter"><div data-title="What Are We Building?" data-file="migrations/versions/0f4bcb7f3ccb_create_order_table.py" class="step"><h2 id="eta-notifications">Eta Notifications</h2>
<h2 id="laundry-on-demand">Laundry On-Demand</h2>
<p><img src="http://howtodocs.s3.amazonaws.com/eta-notifications.png" alt="ETA Notifications"></p>
<p>There are a wide range of businesses that deliver goods or services to
their customers on-demand. Companies like Uber, TaskRabbit, and
Instacart have built an entire industry around the fact that we, the
customer, like to order things instantly, wherever we are. The key to
those services working is notifying customers instantly when things
change.</p>
<p>On this tutorial we&#39;ll build a notification system for Laundr.io, an
on-demand laundry service.</p>
<p>Let&#39;s get started!</p>
</div><div data-title="Trigger the Notifications" data-file="eta_notifications_flask/views.py" data-highlight="33-59" class="step"><h2 id="trigger-the-notifications">Trigger the Notifications</h2>
<p>This screen shows two buttons that allow the laundry delivery person to
trigger notifications. There are two cases we&#39;d like to handle:</p>
<ol>
<li>Delivery person picks up laundry to be delivered.</li>
<li>Delivery person is arriving to the customer&#39;s house.</li>
</ol>
<p>In a production app we would probably trigger the second notification
when the delivery person was physically near the customer, using GPS. In
this case we&#39;ll just use a button.</p>
<p>On the server we&#39;re going to use the Twilio API Client to actually
send out the notifications.</p>
</div><div data-title="Setting Up the Twilio REST Client" data-file="eta_notifications_flask/views.py" data-highlight="8-11" class="step"><h2 id="setting-up-the-twilio-rest-client">Setting Up the Twilio REST Client</h2>
<p>We instantiate a Twilio REST client with our <a href="//www.twilio.com/user/account/settings">Twilio Account
Credentials</a> stored
as environment variables.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//www.twilio.com/docs/quickstart/python/sms/sending-via-rest">Twilio Rest Client - Send SMS</a></li>
</ul>
</div><div data-title="Handling the Notification Trigger" data-file="eta_notifications_flask/views.py" data-highlight="40-43, 54-57" class="step"><h2 id="handling-the-notification-trigger">Handling the Notification Trigger</h2>
<p>We extract the phone number stored in each order,
and then simply send an SMS message with the specified body.</p>
<p>Next let&#39;s look closer at how we send the SMS.</p>
</div></div><div data-title="Sending the Message" data-file="eta_notifications_flask/views.py" data-highlight="11-15" class="step"><h2 id="sending-the-message">Sending the Message</h2>
<p>This is how we actually send the SMS. If we want to improve
the message we can send a picture of the laundry by adding:</p>
<pre><code class="cm-s-monokai lang-python"><span class="cm-variable">media_url</span>=<span class="cm-string">&#39;http://lorempixel.com/image_output/fashion-q-c-640-480-1.jpg&#39;</span>
</code></pre>
<p>In addition to the required parameters, we can pass a <code>status_callback</code>
url to let us know if the message was delivered. Let&#39;s take a closer
look at how this works.</p>
</div><div data-title="Handling the Twilio Callback" data-file="eta_notifications_flask/views.py" data-highlight="61-67" class="step"><h2 id="handling-the-twilio-callback">Handling the Twilio Callback</h2>
<p>Twilio will make a post request to this controller each time our message
status changes to one of the following: queued, failed, sent, delivered, or
undelivered.</p>
<p>We then update this <code>notification_status</code> on the <code>Order</code> so that we can decide
what to do next with the Order. This is a great place to add logic that would
resend the message or send out an
<a href="//www.twilio.com/docs/tutorials/walkthrough/automated-survey/python/django">automated survey</a>.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//www.twilio.com/docs/api/rest/sending-messages#status-callback-parameter-request-parameters">Message Status Parameter</a></li>
<li><a href="//www.twilio.com/docs/api/rest/message#sms-status-values">Message Status Values</a></li>
</ul>
</div><div class="step"><h2 id="where-to-next-">Where to next?</h2>
<p>That&#39;s it! We&#39;ve just implemented an on-demand notification service that
alerts our customers when their order is arriving.</p>
<p>If you are a Python developer working with Twilio,  you might want
to check out these other tutorials:</p>
<p><a href="//www.twilio.com/docs/howto/walkthrough/workflow-automation/python/flask"><strong>Workflow Automation</strong></a></p>
<p>Increase your rate of response by automating the workflows that are key
to your business. In this tutorial, learn how to build a ready-for-scale
automated SMS workflow, for a vacation rental company.</p>
<p><a href="//www.twilio.com/docs/howto/walkthrough/masked-numbers/python/flask"><strong>Masked Numbers</strong></a></p>
<p>Protect your users&#39; privacy by anonymously connecting them with Twilio
Voice and SMS. Learn how to create disposable phone numbers on-demand,
so two users can communicate without exchanging personal information.</p>
<h2 id="did-this-help-">Did this help?</h2>
<p>Thanks for checking out this tutorial! If you have any feedback to share
with us, we&#39;d love to hear it. Tweet
<a href="http://twitter.com/twilio">@twilio</a> to let us know what you think.</p>
</div>
<div class="saurus-files" style="display:none;"><textarea class="saurus-file" data-file="migrations/versions/0f4bcb7f3ccb_create_order_table.py" data-mode="python">IiIiY3JlYXRlIG9yZGVyIHRhYmxlCgpSZXZpc2lvbiBJRDogMGY0YmNiN2YzY2NiClJldmlzZXM6CkNyZWF0ZSBEYXRlOiAyMDE2LTAyLTE4IDE2OjAwOjI5LjM0NDAyNQoKIiIiCgojIHJldmlzaW9uIGlkZW50aWZpZXJzLCB1c2VkIGJ5IEFsZW1iaWMuCnJldmlzaW9uID0gJzBmNGJjYjdmM2NjYicKZG93bl9yZXZpc2lvbiA9IE5vbmUKYnJhbmNoX2xhYmVscyA9IE5vbmUKZGVwZW5kc19vbiA9IE5vbmUKCmZyb20gYWxlbWJpYyBpbXBvcnQgb3AKaW1wb3J0IHNxbGFsY2hlbXkgYXMgc2EKCmRlZiB1cGdyYWRlKCk6CiAgICBvcC5jcmVhdGVfdGFibGUoCiAgICAgICAgJ29yZGVycycsCiAgICAgICAgc2EuQ29sdW1uKCdpZCcsIHNhLkludGVnZXIsIHByaW1hcnlfa2V5PVRydWUpLAogICAgICAgIHNhLkNvbHVtbignY3VzdG9tZXJfbmFtZScsIHNhLlN0cmluZyg1MCksIG51bGxhYmxlPUZhbHNlKSwKICAgICAgICBzYS5Db2x1bW4oJ2N1c3RvbWVyX3Bob25lX251bWJlcicsIHNhLlN0cmluZygyMCksIG51bGxhYmxlPUZhbHNlKSwKICAgICAgICBzYS5Db2x1bW4oJ3N0YXR1cycsIHNhLlN0cmluZygyMCksIG51bGxhYmxlPUZhbHNlKSwKICAgICAgICBzYS5Db2x1bW4oJ25vdGlmaWNhdGlvbl9zdGF0dXMnLCBzYS5TdHJpbmcoMjApLCBudWxsYWJsZT1GYWxzZSkKICAgICkKCmRlZiBkb3duZ3JhZGUoKToKICAgIG9wLmRyb3BfdGFibGUoJ29yZGVycycpCg==</textarea>
<textarea class="saurus-file" data-file="eta_notifications_flask/views.py" data-mode="python">ZnJvbSBldGFfbm90aWZpY2F0aW9uc19mbGFzayBpbXBvcnQgYXBwLCBkYgpmcm9tIGZsYXNrIGltcG9ydCB1cmxfZm9yLCBmbGFzaCwgcmVkaXJlY3QsIHJlbmRlcl90ZW1wbGF0ZSwgcmVxdWVzdApmcm9tIHR3aWxpby5yZXN0IGltcG9ydCBUd2lsaW9SZXN0Q2xpZW50Cgpmcm9tIGV0YV9ub3RpZmljYXRpb25zX2ZsYXNrLm1vZGVscyBpbXBvcnQgT3JkZXIKCmRlZiBfc2VuZF9zbXNfbm90aWZpY2F0aW9uKHRvLCBtZXNzYWdlX2JvZHksIGNhbGxiYWNrX3VybCk6CiAgICBhY2NvdW50X3NpZCA9IGFwcC5jb25maWdbJ1RXSUxJT19BQ0NPVU5UX1NJRCddCiAgICBhdXRoX3Rva2VuICA9IGFwcC5jb25maWdbJ1RXSUxJT19BVVRIX1RPS0VOJ10KICAgIHR3aWxpb19udW1iZXIgPSBhcHAuY29uZmlnWydUV0lMSU9fTlVNQkVSJ10KICAgIGNsaWVudCA9IFR3aWxpb1Jlc3RDbGllbnQoYWNjb3VudF9zaWQsIGF1dGhfdG9rZW4pCiAgICBjbGllbnQubWVzc2FnZXMuY3JlYXRlKHRvPXRvLAogICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tXz10d2lsaW9fbnVtYmVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICBib2R5PW1lc3NhZ2VfYm9keSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzX2NhbGxiYWNrPWNhbGxiYWNrX3VybCkKCkBhcHAucm91dGUoJy8nKQpkZWYgaG9tZSgpOgogICAgcmV0dXJuIHJlbmRlcl90ZW1wbGF0ZSgnaG9tZS5odG1sJykKCkBhcHAucm91dGUoJy9vcmRlcnMnKQpkZWYgb3JkZXJfaW5kZXgoKToKICAgIG9yZGVycyA9IE9yZGVyLnF1ZXJ5LmFsbCgpCgogICAgcmV0dXJuIHJlbmRlcl90ZW1wbGF0ZSgnaW5kZXguaHRtbCcsIG9yZGVycz1vcmRlcnMpCgpAYXBwLnJvdXRlKCcvb3JkZXIvPG9yZGVyX2lkPicpCmRlZiBvcmRlcl9zaG93KG9yZGVyX2lkKToKICAgIG9yZGVyID0gT3JkZXIucXVlcnkuZ2V0KG9yZGVyX2lkKQoKICAgIHJldHVybiByZW5kZXJfdGVtcGxhdGUoJ3Nob3cuaHRtbCcsIG9yZGVyPW9yZGVyKQoKQGFwcC5yb3V0ZSgnL29yZGVyLzxvcmRlcl9pZD4vcGlja3VwJywgbWV0aG9kcz1bIlBPU1QiXSkKZGVmIG9yZGVyX3BpY2t1cChvcmRlcl9pZCk6CiAgICBvcmRlciA9IE9yZGVyLnF1ZXJ5LmdldChvcmRlcl9pZCkKICAgIG9yZGVyLnN0YXR1cyA9ICdTaGlwcGVkJwogICAgb3JkZXIubm90aWZpY2F0aW9uX3N0YXR1cyA9ICdxdWV1ZWQnCiAgICBkYi5zZXNzaW9uLmNvbW1pdCgpCgogICAgY2FsbGJhY2tfdXJsID0gcmVxdWVzdC5iYXNlX3VybC5yZXBsYWNlKCcvcGlja3VwJywgJycpICsgJy9ub3RpZmljYXRpb24vc3RhdHVzL3VwZGF0ZScKICAgIF9zZW5kX3Ntc19ub3RpZmljYXRpb24ob3JkZXIuY3VzdG9tZXJfcGhvbmVfbnVtYmVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICdZb3VyIGxhdW5kcnkgaXMgZG9uZSBhbmQgb24gaXRzIHdheSB0byB5b3UhJywKICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFja191cmwpCgogICAgcmV0dXJuIHJlZGlyZWN0KHVybF9mb3IoJ29yZGVyX3Nob3cnLCBvcmRlcl9pZD1vcmRlcl9pZCkpCgpAYXBwLnJvdXRlKCcvb3JkZXIvPG9yZGVyX2lkPi9kZWxpdmVyJywgbWV0aG9kcz1bIlBPU1QiXSkKZGVmIG9yZGVyX2RlbGl2ZXIob3JkZXJfaWQpOgogICAgb3JkZXIgPSBPcmRlci5xdWVyeS5nZXQob3JkZXJfaWQpCiAgICBvcmRlci5zdGF0dXMgPSAnRGVsaXZlcmVkJwogICAgb3JkZXIubm90aWZpY2F0aW9uX3N0YXR1cyA9ICdxdWV1ZWQnCiAgICBkYi5zZXNzaW9uLmNvbW1pdCgpCgogICAgY2FsbGJhY2tfdXJsID0gcmVxdWVzdC5iYXNlX3VybC5yZXBsYWNlKCcvZGVsaXZlcicsICcnKSArICcvbm90aWZpY2F0aW9uL3N0YXR1cy91cGRhdGUnCiAgICBfc2VuZF9zbXNfbm90aWZpY2F0aW9uKG9yZGVyLmN1c3RvbWVyX3Bob25lX251bWJlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAnWW91ciBsYXVuZHJ5IGlzIGFycml2aW5nIG5vdy4nLAogICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrX3VybCkKCiAgICByZXR1cm4gcmVkaXJlY3QodXJsX2Zvcignb3JkZXJfaW5kZXgnKSkKCkBhcHAucm91dGUoJy9vcmRlci88b3JkZXJfaWQ+L25vdGlmaWNhdGlvbi9zdGF0dXMvdXBkYXRlJywgbWV0aG9kcz1bIlBPU1QiXSkKZGVmIG9yZGVyX2RlbGl2ZXJfc3RhdHVzKG9yZGVyX2lkKToKICAgIG9yZGVyID0gT3JkZXIucXVlcnkuZ2V0KG9yZGVyX2lkKQogICAgb3JkZXIubm90aWZpY2F0aW9uX3N0YXR1cyA9IHJlcXVlc3QuZm9ybVsnTWVzc2FnZVN0YXR1cyddCiAgICBkYi5zZXNzaW9uLmNvbW1pdCgpCgogICAgcmV0dXJuIHJlbmRlcl90ZW1wbGF0ZSgnc2hvdy5odG1sJywgb3JkZXI9b3JkZXIpCg==</textarea>
</div>
</div><div class="saurus-overview"><ul></ul></div></div><div class="saurus-code"><div class="file-path"><span class="crumb-container"></span><i class="fa fa-fw fa-folder"></i></div><div class="saurus-editor"></div></div><div class="saurus-explorer"><div class="saurus-file-list"></div><a href="https://github.com/TwilioDevEd/eta-notifications-flask" target="_blank" class="explorer-get-code"> <i class="fa fa-lg fa-github-square"> </i>View Code on GitHub</a></div></div></div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script><script src="ace/ace.js"></script><script src="ace/theme-monokai.js"></script><script src="viewsaurus.js"></script></body></html>